<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Trivial Pursuit Prototype</title>
<style>
  body {
    margin: 0;
    padding: 0;
    font-family: Arial, sans-serif;
    height: 100vh;
    background: black;
    overflow: hidden;
  }

  .screen {
    position: absolute;
    top: 0; left: 0;
    width: 100%; height: 100%;
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.5s ease;
    background: black;
    box-sizing: border-box;
  }
  .screen.active { opacity: 1; pointer-events: auto; z-index: 1; }

  .screen-inner {
    display: flex;
    flex-direction: column;
    height: 100%;
    padding: 20px;
    box-sizing: border-box;
  }

  h2 { text-align: center; color: white; margin: 20px 0; }

  .btn-grid {
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    gap: 10px;
  }

  .btn {
    width: 90%; max-width: 300px;
    padding: 15px 20px; font-size: 16px;
    border: none; border-radius: 8px;
    background: #ddd; cursor: pointer;
    flex: 1 1 calc(50% - 20px);
    transition: transform 0.1s, background 0.2s;
  }
  .btn:hover:not(.disabled){ background: #bbb; }
  .btn:active{ transform: scale(0.95); }
  .disabled{ background: #eee; color: #aaa; cursor: default; }

  #startGame {
    width: 90%; max-width: 300px;
    padding: 15px 0; font-size: 18px;
    border-radius: 12px; background: #007bff;
    color: white;
  }
  #startGame:disabled{ background: #aaa; }

  .footer {
    margin-top: auto;
    display: flex; justify-content: center;
  }

  .dropdown-grid {
    display: flex;
    justify-content: center;
    gap: 20px;
    flex-wrap: wrap;
    margin: 10px 0 20px 0;
  }

  .custom-select select {
    padding: 12px 40px 12px 15px;
    border-radius: 12px;
    border: 1px solid #ccc;
    background: #f0f0f0;
    font-size: 16px;
    cursor: pointer;
  }

  /* Card Styles */
  .card {
    position: absolute;
    top: 10px; left: 10px; right: 10px; bottom: 10px;
    border-radius: 20px;
    overflow: hidden;
    perspective: 1000px;
  }
  .card-inner {
    width: 100%; height: 100%;
    position: relative;
    transform-style: preserve-3d;
    transition: transform 0.6s;
    cursor: pointer;
  }
  .card-face {
    position: absolute; width: 100%; height: 100%;
    backface-visibility: hidden;
    border-radius: 20px; overflow: hidden;
    display: flex; flex-direction: column;
    padding: 20px; color: white; text-align: center;
    box-sizing: border-box;
  }
  .card-back{ transform: rotateY(180deg); }

  .card-face .header {
    position: absolute;
    top: 20px; left: 20px; right: 60px;
    font-size: 20px; font-weight: bold;
    text-align: left;
  }
  .card-face .content-wrapper {
    flex: 1;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    text-align: center;
    margin-top: 60px;
  }

  .question, .answer { font-size: 20px; margin: 10px 0; }

  .next-btn {
    padding: 10px 24px; font-size: 16px;
    border-radius: 10px; background: #555;
    color: white; border: none; cursor: pointer;
    align-self: center; margin-top: auto;
  }
  .next-btn:hover{ background: #777; }
  .next-btn:active{ transform: scale(0.97); }

  .close-btn {
    position: absolute; top: 20px; right: 20px;
    font-size: 32px; font-weight: bold;
    cursor: pointer; color: white;
  }
</style>
</head>
<body>

<!-- Setup Screen -->
<div id="setupScreen" class="screen active">
  <div class="screen-inner">
    <h2>Select Board</h2>
    <div class="btn-grid" id="editionOptions">
      <button class="btn edition-btn">Genus Edition (1981)</button>
      <button class="btn edition-btn">Millennium (1998)</button>
      <button class="btn edition-btn">20th Anniversary (2002)</button>
      <button class="btn edition-btn">25th Silver Anniversary (2008)</button>
    </div>

    <h2>Select Timeframe</h2>
    <div class="dropdown-grid">
      <select id="oldestYear">
        <option value="">Oldest Year</option>
        <option value="1950">1950</option>
        <option value="1960">1960</option>
        <option value="1970">1970</option>
        <option value="1980">1980</option>
        <option value="1990">1990</option>
        <option value="2000">2000</option>
        <option value="2010">2010</option>
        <option value="2020">2020</option>
      </select>

      <select id="newestYear">
        <option value="">Newest Year</option>
        <option value="1970">1970</option>
        <option value="1980">1980</option>
        <option value="1990">1990</option>
        <option value="2000">2000</option>
        <option value="2010">2010</option>
        <option value="2020">2020</option>
      </select>
    </div>

    <div class="footer">
      <button id="startGame" class="btn" disabled>Start Game</button>
    </div>
  </div>
</div>

<!-- Categories Screen -->
<div id="categoriesScreen" class="screen">
  <div class="screen-inner">
    <h2>Select a Category</h2>
    <div class="btn-grid" id="categoryGrid"></div>
    <div class="footer">
      <button id="backToSetup" class="btn">Setup</button>
    </div>
  </div>
</div>

<!-- Card Screen -->
<div id="cardScreen" class="screen">
  <div class="card" id="card">
    <div class="card-inner">
      <div class="card-face card-front" id="cardFront">
        <span class="close-btn" id="closeFront">&times;</span>
        <div class="header" id="frontHeader">Category Header</div>
        <div class="content-wrapper">
          <div class="question" id="frontQuestion">Question will appear here</div>
        </div>
      </div>
      <div class="card-face card-back" id="cardBack">
        <span class="close-btn" id="closeBack">&times;</span>
        <div class="header" id="backHeader">Category Header</div>
        <div class="content-wrapper">
          <div class="question" id="backQuestion">Answer will appear here</div>
          <div class="answer" id="cardAnswer"></div>
          <button class="next-btn" id="nextQuestion">Next Question</button>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
const setupScreen = document.getElementById("setupScreen");
const categoriesScreen = document.getElementById("categoriesScreen");
const cardScreen = document.getElementById("cardScreen");
const startGameBtn = document.getElementById("startGame");
const editionBtns = document.querySelectorAll(".edition-btn");
const categoryGrid = document.getElementById("categoryGrid");
const oldestYearSelect = document.getElementById("oldestYear");
const newestYearSelect = document.getElementById("newestYear");

const card = document.getElementById("card");
const frontHeader = document.getElementById("frontHeader");
const backHeader = document.getElementById("backHeader");
const frontQuestion = document.getElementById("frontQuestion");
const backQuestion = document.getElementById("backQuestion");
const cardAnswer = document.getElementById("cardAnswer");
const closeFront = document.getElementById("closeFront");
const closeBack = document.getElementById("closeBack");
const nextQuestionBtn = document.getElementById("nextQuestion");
const backToSetupBtn = document.getElementById("backToSetup");

let selectedEdition = null;
let flipCount = 0;

const editionCategories = {
  "Genus Edition (1981)": ["Geography", "Entertainment", "History", "Art & Literature", "Science & Nature", "Sports & Leisure"],
  "Millennium (1998)": ["People & Places", "Arts & Entertainment", "History", "Science & Nature", "Sports & Leisure", "Wild Card"],
  "20th Anniversary (2002)": ["Global View", "Sound & Screen", "News", "The Written Word", "Innovations", "Game Time"],
  "25th Silver Anniversary (2008)": ["Geography", "Entertainment", "History", "Art & Literature", "Science & Nature", "Sports & Leisure"]
};

function updateSelections(btns, selectedVar){
  btns.forEach(btn => btn.classList.toggle("disabled", btn.textContent !== selectedVar));
}

function checkStartReady(){
  startGameBtn.disabled = !(selectedEdition && oldestYearSelect.value && newestYearSelect.value);
}

editionBtns.forEach(btn=>{
  btn.addEventListener("click",()=>{
    selectedEdition = btn.textContent;
    updateSelections(editionBtns, selectedEdition);
    checkStartReady();
  });
});

oldestYearSelect.addEventListener("change", checkStartReady);
newestYearSelect.addEventListener("change", checkStartReady);

function populateCategories(edition){
  categoryGrid.innerHTML = "";
  editionCategories[edition].forEach(cat=>{
    const btn = document.createElement("button");
    btn.classList.add("btn");
    btn.textContent = cat;

    btn.addEventListener("click", async ()=>{
      const timeframe = `${oldestYearSelect.value} - ${newestYearSelect.value}`;
      frontHeader.textContent = `${timeframe} ${cat}`;
      backHeader.textContent = `${timeframe} ${cat}`;

      frontQuestion.textContent = "Loading...";
      backQuestion.textContent = "";
      cardAnswer.textContent = "";

      setupScreen.classList.remove("active");
      categoriesScreen.classList.remove("active");
      cardScreen.classList.add("active");

      // Fetch question from backend page
      const iframe = document.createElement("iframe");
      iframe.src = "questionEndpoint.html";
      iframe.style.display = "none";
      document.body.appendChild(iframe);
      iframe.onload = async ()=>{
        const result = await iframe.contentWindow.fetchQuestion(cat, timeframe);
        frontQuestion.textContent = result.question;
        backQuestion.textContent = result.answer;
        document.body.removeChild(iframe);
      };
    });

    categoryGrid.appendChild(btn);
  });
}

startGameBtn.addEventListener("click", ()=>{
  populateCategories(selectedEdition);
  setupScreen.classList.remove("active");
  categoriesScreen.classList.add("active");
});

backToSetupBtn.addEventListener("click", ()=>{
  categoriesScreen.classList.remove("active");
  setupScreen.classList.add("active");
});

nextQuestionBtn.addEventListener("click", e=>{
  e.stopPropagation();
  flipCount = 0;
  card.querySelector(".card-inner").style.transform = "rotateY(0deg)";
  cardScreen.classList.remove("active");
  categoriesScreen.classList.add("active");
});

card.addEventListener("click", ()=>{
  flipCount++;
  card.querySelector(".card-inner").style.transform = `rotateY(${180*flipCount}deg)`;
});

closeFront.addEventListener("click", e=>{
  e.stopPropagation();
  flipCount=0;
  card.querySelector(".card-inner").style.transform='rotateY(0deg)';
  cardScreen.classList.remove("active");
  categoriesScreen.classList.add("active");
});
closeBack.addEventListener("click", e=>{
  e.stopPropagation();
  flipCount=0;
  card.querySelector(".card-inner").style.transform='rotateY(0deg)';
  cardScreen.classList.remove("active");
  categoriesScreen.classList.add("active");
});
</script>
</body>
</html>
