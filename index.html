<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Online Trivial Pursuit</title>
<link rel="icon" type="image/png" href="favicon.png">
<style>
  body { font-family: Arial, sans-serif; margin: 0; padding: 0; height: 100vh; background: black; overflow: hidden; }
  .screen { position: absolute; top: 0; left: 0; width: 100%; height: 100%; opacity: 0; pointer-events: none; transition: opacity 0.5s ease; background: black; box-sizing: border-box; }
  .screen:not(#setupScreen) .screen-inner { overflow: hidden; }
  .screen.active { opacity: 1; pointer-events: auto; z-index: 1; }
  .screen-inner { display: flex; flex-direction: column; height: 100%; padding: 20px; box-sizing: border-box; }
  h2 { text-align: center; margin: 20px 0; color: white; }
  .btn-grid { display: flex; flex-wrap: wrap; justify-content: center; gap: 10px; padding: 0 50px; }
  .btn { width: 90%; max-width: 300px; padding: 15px 10px; font-size: 16px; border: none; border-radius: 8px; background: #ddd; cursor: pointer; text-align: center; transition: transform 0.1s, background 0.2s; flex: 1 1 calc(50% - 20px); }
  .btn:hover:not(.disabled) { background: #bbb; }
  .btn:active { transform: scale(0.95); }
  .disabled { background: #eee; color: #aaa; cursor: default; }
  #startGame { width: 90%; max-width: 300px; padding: 15px 0; font-size: 18px; border-radius: 12px; background: #007bff; color: white; }
  #startGame:disabled { background: #444; }
  #setupScreen .screen-inner { max-height: 100vh; overflow-y: auto; box-sizing: border-box; -webkit-overflow-scrolling: touch; padding-bottom: 0px; }
  #pageFooter { background-color: #000; color: #444; text-align: center; font-size: 14px; padding: 8px 0; margin-top: 20px; }
  #pageFooter a { color: #444; text-decoration: underline; margin-left: 15px; }
  #pageFooter a:hover { color: #888; }
  .footer { margin-top: auto; display: flex; justify-content: center; }
  .footer .btn { width: 90%; max-width: 300px; padding: 15px 0; font-size: 18px; border-radius: 12px; background: #555; color: white; font-weight: bold; transition: background 0.2s; }
  .footer .btn:hover { background: #777; }
  .content-top { display: flex; flex-direction: column; gap: 20px; margin-bottom: 100px; }
  .dropdown-grid { display: flex; justify-content: center; gap: 20px; flex-wrap: wrap; margin: 10px 0 20px 0; }
  .custom-select { position: relative; display: inline-block; }
  .custom-select select { appearance: none; padding: 12px 40px 12px 15px; border-radius: 12px; border: 1px solid #ccc; background: #f0f0f0; cursor: pointer; font-size: 16px; }
  .custom-select::after { content: "â–¼"; position: absolute; top: 50%; right: 15px; transform: translateY(-50%); pointer-events: none; color: #333; font-size: 14px; }
  .card { position: absolute; top: 10px; left: 10px; right: 10px; bottom: 10px; border-radius: 20px; overflow: hidden; perspective: 1000px; }
  .card-inner { width: 100%; height: 100%; position: relative; transform-style: preserve-3d; transition: transform 0.6s; cursor: pointer; }
  .card-face { position: absolute; width: 100%; height: 100%; backface-visibility: hidden; border-radius: 20px; overflow: hidden; display: flex; flex-direction: column; color: white; box-sizing: border-box; padding: 20px; }
  .card-back { transform: rotateY(180deg); }
  .card-face .header { position: absolute; top: 20px; left: 20px; right: 60px; font-size: 20px; font-weight: bold; text-align: left; }
  .card-face .content-wrapper { display: flex; flex-direction: column; height: 100%; padding-top: 60px; box-sizing: border-box; }
  .center-content { flex: 1; display: flex; flex-direction: column; justify-content: center; align-items: center; }
  .next-btn { margin-top: auto; padding: 10px 24px; font-size: 16px; border-radius: 10px; background: #555; color: white; border: none; cursor: pointer; transition: background 0.2s, transform 0.1s; }
  .next-btn:hover { background: #777; }
  .next-btn:active { transform: scale(0.97); }
  .question { font-size: 24px; font-weight: bold; margin-bottom: 10px; text-align: center; white-space: pre-line; }
  .answer { font-size: 20px; text-align: center; }
  .close-btn { position: absolute; top: 20px; right: 20px; font-size: 32px; font-weight: bold; cursor: pointer; color: white; }
  @media (max-width: 500px) { .btn { padding: 12px; font-size: 14px; } h2 { font-size: 18px; } .btn-grid, .dropdown-grid { flex-direction: column; align-items: center; gap: 10px; } }
</style>
</head>
<body>

<!-- Setup Screen -->
<div id="setupScreen" class="screen active">
  <div class="screen-inner">
    <div class="content-top">
      <h2>Select Board</h2>
      <div class="btn-grid" id="editionOptions">
        <button class="btn edition-btn">Genus Edition (1981)</button>
        <button class="btn edition-btn">Millennium (1998)</button>
        <button class="btn edition-btn">20th Anniversary (2002)</button>
        <button class="btn edition-btn">25th Silver Anniversary (2008)</button>
      </div>

      <h2>Select Timeframe</h2>
      <div class="dropdown-grid">
        <div class="custom-select">
          <select id="oldestYear">
            <option value="">Oldest Year</option>
            <option value="1950">1950</option>
            <option value="1960">1960</option>
            <option value="1970">1970</option>
            <option value="1980">1980</option>
            <option value="1990">1990</option>
            <option value="2000">2000</option>
            <option value="2010">2010</option>
            <option value="2020">2020</option>
          </select>
        </div>
        <div class="custom-select">
          <select id="newestYear">
            <option value="">Newest Year</option>
            <option value="1970">1970</option>
            <option value="1980">1980</option>
            <option value="1990">1990</option>
            <option value="2000">2000</option>
            <option value="2010">2010</option>
            <option value="2020">2020</option>
          </select>
        </div>
      </div>

      <h2>Select Difficulty</h2>
      <div class="dropdown-grid">
        <div class="custom-select">
          <select id="difficultySelect">
            <option value="">Any</option>
            <option value="easy">Easy</option>
            <option value="medium">Medium</option>
            <option value="hard">Hard</option>
          </select>
        </div>
      </div>
    </div>

    <div class="footer">
      <button id="startGame" class="btn" disabled>Start Game</button>
    </div>
<footer id="pageFooter">
      <p>&copy; 2025 Samuel Davy<a href="about.html">About</a></p>
    </footer>
  </div>
</div>

<!-- Categories Screen -->
<div id="categoriesScreen" class="screen">
  <div class="screen-inner">
    <div>
      <h2>Select a Category</h2>
      <div class="btn-grid" id="categoryGrid"></div>
    </div>
    <div class="footer">
      <button id="backToSetup" class="btn">Setup</button>
    </div>
  </div>
</div>

<!-- Card Screen -->
<div id="cardScreen" class="screen">
  <div class="card" id="card">
    <div class="card-inner">
      <div class="card-face card-front" id="cardFront">
        <span class="close-btn" id="closeFront">&times;</span>
        <div class="header" id="frontHeader">Category Header</div>
        <div class="content-wrapper">
          <div class="center-content">
            <div class="question" id="frontQuestion">Sample Question</div>
          </div>
        </div>
      </div>
      <div class="card-face card-back" id="cardBack">
        <span class="close-btn" id="closeBack">&times;</span>
        <div class="header" id="backHeader">Category Header</div>
        <div class="content-wrapper">
          <div class="center-content">
            <div class="question" id="backQuestion">Sample Question</div>
            <div class="answer" id="cardAnswer">Sample Answer</div>
          </div>
          <button class="next-btn" id="nextQuestion">Next Question</button>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
const setupScreen = document.getElementById("setupScreen");
const categoriesScreen = document.getElementById("categoriesScreen");
const cardScreen = document.getElementById("cardScreen");
const startGameBtn = document.getElementById("startGame");
const editionBtns = document.querySelectorAll(".edition-btn");
const card = document.getElementById("card");
const frontHeader = document.getElementById("frontHeader");
const backHeader = document.getElementById("backHeader");
const frontQuestion = document.getElementById("frontQuestion");
const backQuestion = document.getElementById("backQuestion");
const cardAnswer = document.getElementById("cardAnswer");
const closeFront = document.getElementById("closeFront");
const closeBack = document.getElementById("closeBack");
const backToSetupBtn = document.getElementById("backToSetup");
const nextQuestionBtn = document.getElementById("nextQuestion");
const categoryGrid = document.getElementById("categoryGrid");
const oldestYearSelect = document.getElementById("oldestYear");
const newestYearSelect = document.getElementById("newestYear");
const difficultySelect = document.getElementById("difficultySelect");

let selectedEdition = null;
let flipCount = 0;

const editionCategories = {
  "Genus Edition (1981)": [
    { name: "Geography", color: "#1976d2" },
    { name: "Entertainment", color: "#e91e63" },
    { name: "History", color: "#fbc02d" },
    { name: "Art & Literature", color: "#6d4c41" },
    { name: "Science & Nature", color: "#388e3c" },
    { name: "Sports & Leisure", color: "#f57c00" }
  ],
  "Millennium (1998)": [
    { name: "People & Places", color: "#018dd6" },
    { name: "Arts & Entertainment", color: "#c9356c" },
    { name: "History", color: "#eac157" },
    { name: "Science & Nature", color: "#886b64" },
    { name: "Sports & Leisure", color: "#78a474" },
    { name: "Wild Card", color: "#ea9974" }
  ],
  "20th Anniversary (2002)": [
    { name: "Global View", color: "#3f5486" },
    { name: "Sound & Screen", color: "#a24664" },
    { name: "News", color: "#d2b374" },
    { name: "The Written Word", color: "#9f836d" },
    { name: "Innovations", color: "#85b18f" },
    { name: "Game Time", color: "#c38053" }
  ],
  "25th Silver Anniversary (2008)": [
    { name: "Geography", color: "#01a6dc" },
    { name: "Entertainment", color: "#ff4199" },
    { name: "History", color: "#fcf505" },
    { name: "Art & Literature", color: "#7e0085" },
    { name: "Science & Nature", color: "#147c40" },
    { name: "Sports & Leisure", color: "#e84f00" }
  ]
};

// ---------- Functions ----------
function updateSelections(btns, selectedVar) {
  btns.forEach(btn => btn.classList.toggle("disabled", btn.textContent !== selectedVar));
}

function checkStartReady() {
  startGameBtn.disabled = !(
    selectedEdition &&
    oldestYearSelect.value &&
    newestYearSelect.value &&
    difficultySelect.value
  );
}

editionBtns.forEach(btn => {
  btn.addEventListener("click", () => {
    selectedEdition = btn.textContent;
    updateSelections(editionBtns, selectedEdition);
    checkStartReady();
  });
});

oldestYearSelect.addEventListener("change", checkStartReady);
newestYearSelect.addEventListener("change", checkStartReady);
difficultySelect.addEventListener("change", checkStartReady);

function populateCategories(edition) {
  categoryGrid.innerHTML = "";
  editionCategories[edition].forEach(cat => {
    const btn = document.createElement("button");
    btn.classList.add("btn", "category-btn");
    btn.style.background = cat.color;
    btn.dataset.category = cat.name;
    btn.textContent = cat.name;

    btn.addEventListener("click", async () => {
      const timeframe = `${oldestYearSelect.value} - ${newestYearSelect.value}`;
      const difficulty = difficultySelect.value || "any";
      const headerText = `${timeframe} ${cat.name}`;
      document.getElementById("cardFront").style.background = cat.color;
      document.getElementById("cardBack").style.background = cat.color;
      frontHeader.textContent = headerText;
      backHeader.textContent = headerText;

      try {
        const res = await fetch(`https://trivialpursuit.samuel-d-davy09.workers.dev/?category=${encodeURIComponent(cat.name)}&timeframe=${encodeURIComponent(timeframe)}&difficulty=${difficulty}`);
        if (!res.ok) throw new Error(`HTTP ${res.status}`);
        const data = await res.json();

        frontQuestion.textContent = data.question || "No question found";
        backQuestion.textContent = data.question || "No question found";
        cardAnswer.textContent = data.answer || "No answer found";
      } catch (err) {
        frontQuestion.textContent = "Error fetching question";
        backQuestion.textContent = "Error fetching question";
        cardAnswer.textContent = err.toString();
      }

      categoriesScreen.classList.remove("active");
      cardScreen.classList.add("active");
    });

    categoryGrid.appendChild(btn);
  });
}

startGameBtn.addEventListener("click", () => {
  setupScreen.classList.remove("active");
  populateCategories(selectedEdition);
  categoriesScreen.classList.add("active");
});

backToSetupBtn.addEventListener("click", () => {
  categoriesScreen.classList.remove("active");
  setupScreen.classList.add("active");
});

nextQuestionBtn.addEventListener("click", e => {
  e.stopPropagation();
  flipCount = 0;
  card.querySelector(".card-inner").style.transform = `rotateY(0deg)`;
  cardScreen.classList.remove("active");
  categoriesScreen.classList.add("active");
});

card.addEventListener("click", () => {
  flipCount++;
  card.querySelector(".card-inner").style.transform = `rotateY(${180 * flipCount}deg)`;
});

closeFront.addEventListener("click", e => { e.stopPropagation(); flipCount = 0; card.querySelector(".card-inner").style.transform = 'rotateY(0deg)'; cardScreen.classList.remove("active"); categoriesScreen.classList.add("active"); });
closeBack.addEventListener("click", e => { e.stopPropagation(); flipCount = 0; card.querySelector(".card-inner").style.transform = 'rotateY(0deg)'; cardScreen.classList.remove("active"); categoriesScreen.classList.add("active"); });

// Ensure newest year >= oldest year
oldestYearSelect.addEventListener("change", () => {
  const oldest = parseInt(oldestYearSelect.value);
  Array.from(newestYearSelect.options).forEach(opt => {
    if (opt.value === "") return; // skip placeholder
    opt.disabled = oldest ? parseInt(opt.value) < oldest : false;
  });
  // Auto-correct newest if current value is now invalid
  if (newestYearSelect.value && parseInt(newestYearSelect.value) < oldest) {
    newestYearSelect.value = "";
  }
  checkStartReady();
});

// Ensure oldest year <= newest year
newestYearSelect.addEventListener("change", () => {
  const newest = parseInt(newestYearSelect.value);
  Array.from(oldestYearSelect.options).forEach(opt => {
    if (opt.value === "") return; // skip placeholder
    opt.disabled = newest ? parseInt(opt.value) > newest : false;
  });
  // Auto-correct oldest if current value is now invalid
  if (oldestYearSelect.value && parseInt(oldestYearSelect.value) > newest) {
    oldestYearSelect.value = "";
  }
  checkStartReady();
});

</script>

</body>
</html>
