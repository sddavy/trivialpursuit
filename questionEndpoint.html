<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Question Endpoint</title>
</head>
<body>
<script>
/**
 * fetchQuestion(category, timeframe)
 * Called from parent page iframe to get a random question
 * Returns a Promise that resolves to {question: "...", answer: "..."}
 */
async function fetchQuestion(category, timeframe) {
    try {
        // Construct a search query combining category and timeframe
        const query = `${category} ${timeframe}`;

        // Call Wikipedia API
        const response = await fetch(`https://en.wikipedia.org/w/api.php?origin=*&action=query&list=search&srsearch=${encodeURIComponent(query)}&format=json&srlimit=20`);
        const data = await response.json();

        if(!data.query.search.length){
            return {question: `No question found for ${category}`, answer: ""};
        }

        // Pick a random article from search results
        const article = data.query.search[Math.floor(Math.random() * data.query.search.length)];

        // Fetch the full article extract (summary)
        const pageResponse = await fetch(`https://en.wikipedia.org/w/api.php?origin=*&action=query&prop=extracts&exintro&explaintext&format=json&pageids=${article.pageid}`);
        const pageData = await pageResponse.json();
        const page = pageData.query.pages[article.pageid];

        const extract = page.extract || "No content available.";

        // Build a simple question: "What is X?" and answer is the extract
        const questionText = `What is ${page.title}?`;
        const answerText = extract;

        return { question: questionText, answer: answerText };

    } catch (err) {
        return { question: "Error fetching question", answer: err.message };
    }
}
</script>
</body>
</html>
